<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modular Image Management Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1><i class="fas fa-cogs"></i> Modular Image Management Demo</h1>
        
        <!-- System Status -->
        <div class="demo-section">
            <h3><i class="fas fa-info-circle"></i> System Status</h3>
            <div id="systemStatus">Loading...</div>
        </div>

        <!-- Configuration -->
        <div class="demo-section">
            <h3><i class="fas fa-cog"></i> Configuration</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Services</h5>
                    <ul id="servicesList"></ul>
                </div>
                <div class="col-md-6">
                    <h5>Features</h5>
                    <ul id="featuresList"></ul>
                </div>
            </div>
        </div>

        <!-- Plugin Status -->
        <div class="demo-section">
            <h3><i class="fas fa-puzzle-piece"></i> Plugin Status</h3>
            <div id="pluginStatus">Loading...</div>
        </div>

        <!-- Test Upload -->
        <div class="demo-section">
            <h3><i class="fas fa-upload"></i> Test Upload</h3>
            <form id="uploadForm">
                <div class="mb-3">
                    <label for="testFile" class="form-label">Select Image File</label>
                    <input type="file" class="form-control" id="testFile" accept="image/*">
                </div>
                <div class="mb-3">
                    <label for="testCategory" class="form-label">Category</label>
                    <select class="form-select" id="testCategory">
                        <option value="banners">Banners</option>
                        <option value="services">Services</option>
                        <option value="projects">Projects</option>
                        <option value="team">Team</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-upload"></i> Test Upload
                </button>
            </form>
            <div id="uploadResult" class="mt-3"></div>
        </div>

        <!-- Stored Images -->
        <div class="demo-section">
            <h3><i class="fas fa-images"></i> Stored Images</h3>
            <div id="storedImages">Loading...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Configuration and Core System -->
    <script src="assets/js/config.js"></script>
    <script src="assets/js/plugins/plugin-manager.js"></script>
    <script src="assets/js/plugins/adapters/local-upload-adapter.js"></script>
    <script src="assets/js/plugins/adapters/local-storage-adapter.js"></script>
    <script src="assets/js/plugins/adapters/local-processing-adapter.js"></script>
    <script src="assets/js/plugins/adapters/placeholder-adapters.js"></script>
    <script src="assets/js/image-management-core.js"></script>

    <script>
        let imageCore = null;

        // Initialize system
        async function initSystem() {
            try {
                imageCore = new ImageManagementCore();
                await imageCore.init();
                
                updateSystemStatus();
                updateConfiguration();
                updatePluginStatus();
                updateStoredImages();
            } catch (error) {
                console.error('System initialization failed:', error);
                document.getElementById('systemStatus').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> System initialization failed: ${error.message}
                    </div>
                `;
            }
        }

        // Update system status
        function updateSystemStatus() {
            if (!imageCore) return;

            const status = imageCore.getStatus();
            const html = `
                <div class="row">
                    <div class="col-md-4">
                        <strong>Environment:</strong> ${CONFIG.getEnvironment()}
                    </div>
                    <div class="col-md-4">
                        <strong>Available Plugins:</strong> ${status.plugins.length}
                    </div>
                    <div class="col-md-4">
                        <strong>Features Enabled:</strong> ${Object.values(status.features).filter(f => f).length}
                    </div>
                </div>
            `;
            document.getElementById('systemStatus').innerHTML = html;
        }

        // Update configuration display
        function updateConfiguration() {
            const services = CONFIG.services;
            const features = CONFIG.features;

            const servicesHtml = Object.entries(services).map(([key, value]) => 
                `<li><span class="status-indicator status-success"></span>${key}: ${value}</li>`
            ).join('');

            const featuresHtml = Object.entries(features).map(([key, value]) => {
                const statusClass = value ? 'status-success' : 'status-warning';
                return `<li><span class="status-indicator ${statusClass}"></span>${key}: ${value ? 'Enabled' : 'Disabled'}</li>`;
            }).join('');

            document.getElementById('servicesList').innerHTML = servicesHtml;
            document.getElementById('featuresList').innerHTML = featuresHtml;
        }

        // Update plugin status
        function updatePluginStatus() {
            if (!imageCore || !imageCore.pluginManager) return;

            const plugins = imageCore.pluginManager.getAvailablePlugins();
            const html = plugins.map(plugin => 
                `<div><span class="status-indicator status-success"></span>${plugin}</div>`
            ).join('');

            document.getElementById('pluginStatus').innerHTML = html || '<div class="text-muted">No plugins loaded</div>';
        }

        // Update stored images
        async function updateStoredImages() {
            if (!imageCore) return;

            try {
                const result = await imageCore.getAllImages();
                if (result.success) {
                    const images = result.data;
                    const html = images.length > 0 ? 
                        images.map(img => `
                            <div class="card mb-2">
                                <div class="card-body">
                                    <h6>${img.name}</h6>
                                    <small class="text-muted">
                                        Category: ${img.category} | 
                                        Size: ${img.size ? (img.size / 1024).toFixed(1) + 'KB' : 'N/A'} |
                                        Uploaded: ${new Date(img.uploadedAt).toLocaleDateString()}
                                    </small>
                                </div>
                            </div>
                        `).join('') : 
                        '<div class="text-muted">No images stored</div>';
                    
                    document.getElementById('storedImages').innerHTML = html;
                } else {
                    document.getElementById('storedImages').innerHTML = 
                        '<div class="text-danger">Error loading images</div>';
                }
            } catch (error) {
                document.getElementById('storedImages').innerHTML = 
                    `<div class="text-danger">Error: ${error.message}</div>`;
            }
        }

        // Handle file upload
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const file = document.getElementById('testFile').files[0];
            const category = document.getElementById('testCategory').value;
            
            if (!file) {
                document.getElementById('uploadResult').innerHTML = 
                    '<div class="alert alert-warning">Please select a file</div>';
                return;
            }

            try {
                const result = await imageCore.uploadImage(file, {
                    category: category,
                    alt: file.name,
                    title: file.name
                });

                if (result.success) {
                    document.getElementById('uploadResult').innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Upload successful! 
                            Image ID: ${result.data.id}
                        </div>
                    `;
                    updateStoredImages();
                } else {
                    document.getElementById('uploadResult').innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> Upload failed: ${result.error}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('uploadResult').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> Error: ${error.message}
                    </div>
                `;
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initSystem);
    </script>
</body>
</html> 